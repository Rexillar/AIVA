/*â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
       â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—
       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘
       â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘
       â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘
       â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•â•â•  â•šâ•â•  â•šâ•â•

   â”€â”€â—ˆâ”€â”€  A I V A  ::  A I   V I R T U A L   A S S I S T A N T  â”€â”€â—ˆâ”€â”€

   â—‰  Deterministic Execution System
   â—‰  Rule-Bound â€¢ State-Aware â€¢ Non-Emotive

   âŸ  SYSTEM LAYER : BACKEND CORE
   âŸ  DOMAIN       : BUSINESS LOGIC

   âŸ  PURPOSE      : Send notifications and alerts to users

   âŸ  WHY          : Real-time user communication

   âŸ  WHAT         : Email and in-app notification system

   âŸ  TECH STACK   : Node.js â€¢ Express â€¢ MongoDB
   âŸ  CRYPTO       : N/A
   âŸ  TRUST LEVEL  : HIGH
   âŸ  DOCS : /docs/backend/tasks.md

   âŸ  USAGE RULES  : Handle errors â€¢ Log operations â€¢ Validate inputs

        "Notifications sent. Users informed. Communication maintained."

                          âŸ¡  A I V A  âŸ¡

                     Â© 2026 Mohitraj Jadeja

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•*/
import Notification from '../models/notification.js'; // Adjust the path as necessary

export const createTaskAssignmentNotifications = async ({ task, previousAssignees, actorId }) => {
    // Logic to create notifications for task assignments
    const notifications = [];

    for (const assignee of task.assignees) {
        if (!previousAssignees.includes(assignee.toString())) {
            const notification = new Notification({
                user: assignee,
                message: `You have been assigned to the task: ${task.title}`,
                task: task._id,
                createdBy: actorId,
                createdAt: new Date()
            });
            notifications.push(notification);
        }
    }

    await Notification.insertMany(notifications);
    return notifications;
};

// Habit-related notifications
export const createHabitNotification = async ({ user, habitId, type, streak }) => {
    let message = '';

    switch (type) {
        case 'streak_milestone':
            message = `ðŸ”¥ Congratulations! You've reached a ${streak}-day streak!`;
            break;
        case 'reminder':
            message = `â° Reminder: Don't forget to complete your habit today!`;
            break;
        case 'streak_broken':
            message = `Your streak was broken. Start a new one today!`;
            break;
        default:
            message = 'Habit notification';
    }

    const notification = await Notification.create({
        user,
        text: message,
        notiType: 'alert',
        link: `/habits/${habitId}`,
        metadata: {
            type: 'habit',
            habitId,
            notificationType: type
        }
    });

    return notification;
};

export const createNotification = async (user, message, link) => {
    const notification = new Notification({
        user,
        message,
        link,
    });
    await notification.save();
    return notification;
};
